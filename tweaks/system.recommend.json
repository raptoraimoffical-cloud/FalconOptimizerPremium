{
  "items": [
    {
      "id": "recommend.auto_preset__system.recommend",
      "type": "action",
      "name": "Analyze and Recommend Falcon Mode",
      "description": "[Analyzer] Reads your hardware/OS state and prints a recommended Falcon preset and hints.",
      "requiresAdmin": true,
      "riskLevel": "Safe",
      "category": "System Analyzer / Recommendations",
      "apply": {
        "steps": [
          {
            "type": "ps.run",
            "command": "Write-Output \"=== FALCON AUTO-RECOMMEND ENGINE ===\"\nWrite-Output \"\"\n\n# Helper: safe int parse\nfunction To-Int($val, $default=0) {\n  try {\n    return [int]$val\n  } catch {\n    return $default\n  }\n}\n\n# OS\n$osCaption = \"\"\n$osVer = \"\"\ntry {\n  $os = Get-CimInstance Win32_OperatingSystem\n  $osCaption = $os.Caption\n  $osVer = $os.Version\n  Write-Output (\"OS: {0} (Version {1})\" -f $osCaption, $osVer)\n} catch {\n  Write-Output \"OS: <failed to query>\"\n}\n\n# CPU\n$cpuName = \"\"\n$cpuMan = \"\"\n$cpuCores = 0\n$cpuThreads = 0\ntry {\n  $cpu = Get-CimInstance Win32_Processor\n  $cpuName = $cpu.Name\n  $cpuMan = $cpu.Manufacturer\n  $cpuCores = To-Int $cpu.NumberOfCores\n  $cpuThreads = To-Int $cpu.NumberOfLogicalProcessors\n  Write-Output \"\"\n  Write-Output \"CPU:\"\n  Write-Output (\"  {0} | Cores: {1} | Threads: {2}\" -f $cpuName, $cpuCores, $cpuThreads)\n} catch {\n  Write-Output \"CPU: <failed to query>\"\n}\n\n# GPU (primary)\n$gpuName = \"\"\n$gpuVendor = \"\"\n$gpuVramGB = 0\ntry {\n  $gpus = Get-CimInstance Win32_VideoController | Where-Object { $_.AdapterRAM -gt 0 }\n  if ($gpus) {\n    # pick the one with max VRAM\n    $primary = $gpus | Sort-Object AdapterRAM -Descending | Select-Object -First 1\n    $gpuName = $primary.Name\n    $gpuVramGB = [math]::Round($primary.AdapterRAM / 1GB, 2)\n    if ($gpuName -match \"NVIDIA\") { $gpuVendor = \"NVIDIA\" }\n    elseif ($gpuName -match \"AMD\" -or $gpuName -match \"Radeon\") { $gpuVendor = \"AMD\" }\n    elseif ($gpuName -match \"Intel\") { $gpuVendor = \"Intel\" }\n    else { $gpuVendor = \"Unknown\" }\n    Write-Output \"\"\n    Write-Output (\"GPU: {0} ({1} GB, Vendor: {2})\" -f $gpuName, $gpuVramGB, $gpuVendor)\n  } else {\n    Write-Output \"GPU: <no VRAM GPUs found>\"\n  }\n} catch {\n  Write-Output \"GPU: <failed to query>\"\n}\n\n# RAM total\n$totalRamGB = 0\ntry {\n  $mem = Get-CimInstance Win32_PhysicalMemory\n  $totalBytes = ($mem | Measure-Object -Property Capacity -Sum).Sum\n  if ($totalBytes -gt 0) {\n    $totalRamGB = [math]::Round($totalBytes / 1GB, 2)\n  }\n  Write-Output \"\"\n  Write-Output (\"RAM: {0} GB total\" -f $totalRamGB)\n} catch {\n  Write-Output \"RAM: <failed to query>\"\n}\n\n# Form-factor (desktop vs laptop)\n$form = \"Unknown\"\ntry {\n  $cs = Get-CimInstance Win32_ComputerSystem\n  $ptype = To-Int $cs.PCSystemType\n  switch ($ptype) {\n    1 { $form = \"Desktop\" }\n    2 { $form = \"Laptop\" }\n    3 { $form = \"Workstation\" }\n    default { $form = \"Unknown\" }\n  }\n  Write-Output \"\"\n  Write-Output (\"Form Factor: {0}\" -f $form)\n} catch {\n  Write-Output \"Form Factor: <failed to query>\"\n}\n\n# Power plan\n$activePlanRaw = \"\"\ntry {\n  $activePlanRaw = (powercfg /getactivescheme 2>$null)\n  Write-Output \"\"\n  Write-Output (\"Power Plan: {0}\" -f $activePlanRaw.Trim())\n} catch {\n  Write-Output \"Power Plan: <failed to query>\"\n}\n\n# HAGS\n$hags = \"Unknown\"\ntry {\n  $gd = Get-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\GraphicsDrivers' -ErrorAction SilentlyContinue\n  if ($gd -and $gd.PSObject.Properties.Name -contains \"HwSchMode\") {\n    switch ([int]$gd.HwSchMode) {\n      1 { $hags = \"Off\" }\n      2 { $hags = \"On\" }\n      default { $hags = \"Default (driver controlled)\" }\n    }\n  }\n  Write-Output \"\"\n  Write-Output (\"HAGS (HwSchMode): {0}\" -f $hags)\n} catch {\n  Write-Output \"HAGS: <failed to query>\"\n}\n\n# Device Guard / VBS\n$vbs = \"Unknown\"\ntry {\n  $dg = Get-CimInstance Win32_DeviceGuard -ErrorAction SilentlyContinue\n  if ($dg) {\n    $running = $dg.SecurityServicesRunning\n    if ($running -contains 1 -or $running -contains 2) {\n      $vbs = \"On\"\n    } else {\n      $vbs = \"Off\"\n    }\n  }\n  Write-Output \"\"\n  Write-Output (\"VBS/HVCI: {0}\" -f $vbs)\n} catch {\n  Write-Output \"VBS/HVCI: <failed to query>\"\n}\n\n# Defender realtime\n$defState = \"Unknown\"\ntry {\n  $mp = Get-MpComputerStatus -ErrorAction SilentlyContinue\n  if ($mp) {\n    $defState = ($mp.RealTimeProtectionEnabled) ? \"On\" : \"Off\"\n  }\n  Write-Output \"\"\n  Write-Output (\"Defender realtime: {0}\" -f $defState)\n} catch {\n  Write-Output \"Defender: <failed to query>\"\n}\n\n# Basic Falcon profile classification\nWrite-Output \"\"\nWrite-Output \"=== Falcon Classification ===\"\n\n$profile = \"GENERIC\"\nif ($form -eq \"Desktop\") {\n  if ($totalRamGB -ge 32 -and $gpuVramGB -ge 8 -and $cpuThreads -ge 16) {\n    $profile = \"DESKTOP-HIGH-END\"\n  } elseif ($totalRamGB -ge 16 -and $gpuVramGB -ge 6) {\n    $profile = \"DESKTOP-MID\"\n  } else {\n    $profile = \"DESKTOP-LOW\"\n  }\n} elseif ($form -eq \"Laptop\") {\n  if ($totalRamGB -ge 16 -and $gpuVramGB -ge 6) {\n    $profile = \"LAPTOP-MID\"\n  } else {\n    $profile = \"LAPTOP-LOW\"\n  }\n}\n\nWrite-Output (\"Profile: {0}\" -f $profile)\nWrite-Output \"\"\n\n# Recommend Falcon preset text\nWrite-Output \"=== Recommended Falcon Mode ===\"\n\nswitch ($profile) {\n  \"DESKTOP-HIGH-END\" {\n    Write-Output \"Recommended: Falcon Extreme Desktop preset + Hardcore Tweaks (with caution).\"\n    Write-Output \" - Enable Game Mode, Speed Core, full Process Lab modes.\"\n    Write-Output \" - Hardcore allowed, but keep Windows Update/Defender restore preset available.\"\n  }\n  \"DESKTOP-MID\" {\n    Write-Output \"Recommended: Falcon Competitive preset.\"\n    Write-Output \" - Game Mode + Speed Core + main debloat, but only partial Hardcore.\"\n    Write-Output \" - Avoid killing ALL update/telemetry services; keep Defender mostly on.\"\n  }\n  \"DESKTOP-LOW\" {\n    Write-Output \"Recommended: Falcon Stability + FPS preset.\"\n    Write-Output \" - Focus on debloat, core scheduler, and Process Lab; avoid most Hardcore until stable.\"\n  }\n  \"LAPTOP-MID\" {\n    Write-Output \"Recommended: Falcon Laptop Competitive preset.\"\n    Write-Output \" - Favor power plan tuning + debloat + network tweaks, but keep thermal and battery safety.\"\n  }\n  \"LAPTOP-LOW\" {\n    Write-Output \"Recommended: Falcon Laptop Safe preset.\"\n    Write-Output \" - Use light debloat and network tweaks, skip aggressive kernel/mitigation changes.\"\n  }\n  default {\n    Write-Output \"Recommended: Start with Balanced Falcon preset, then selectively add Hardcore tweaks.\"\n  }\n}\n\n# Extra targeted hints\nWrite-Output \"\"\nWrite-Output \"=== Extra Hints ===\"\n\nif ($totalRamGB -lt 16) {\n  Write-Output \"- RAM is under 16 GB: prioritize debloat and Process Lab over heavy Hardcore tweaks.\"\n}\n\nif ($gpuVramGB -lt 6 -and $gpuVramGB -gt 0) {\n  Write-Output \"- GPU VRAM < 6 GB: use conservative texture settings and skip extreme resolution scales.\"\n}\n\nif ($form -eq \"Laptop\") {\n  Write-Output \"- Laptop detected: be careful with disabling power management and battery/thermal controls.\"\n}\n\nif ($hags -eq \"On\" -and $gpuVendor -eq \"NVIDIA\") {\n  Write-Output \"- HAGS is ON: good for some modern titles, but if you see stutter, test Falcon's HAGS-OFF tweak.\"\n} elseif ($hags -eq \"Off\" -and $gpuVendor -eq \"NVIDIA\") {\n  Write-Output \"- HAGS is OFF: you can test enabling it for DX12 titles using Falcon's HAGS-ON tweak.\"\n}\n\nif ($vbs -eq \"On\") {\n  Write-Output \"- VBS/HVCI is ON: better security but some latency overhead. Only disable if you understand the risk.\"\n}\n\nif ($defState -eq \"Off\") {\n  Write-Output \"- Defender realtime appears OFF: security is reduced. Make sure this is intentional before going full Hardcore.\"\n}\n\nWrite-Output \"\"\nWrite-Output \"=== End of Recommendation ===\""
          }
        ]
      },
      "revert": {
        "steps": [
          {
            "type": "ps.run",
            "command": "Write-Output @\"\nRecommendation analysis does not change settings, so there is nothing to revert.\n\"@"
          }
        ]
      }
    }
  ]
}